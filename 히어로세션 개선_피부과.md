# Face Style Swap + 체험형 Hero UI (피부과 퍼널) — 구현/기획 MD (보완판)
- 목적: “재미 요소(사진 전환)”를 **전환 장치**로 활용
- UX: 랜딩에서 **샘플로 체험** → 로그인/동의 후 **내 사진 업로드** → 2~3가지 스타일 변환 → 탭/호버 전환 → “피부과 찾기/상담”으로 연결
- 원칙: 참고용/비의료적(진단·처방·치료 효과 암시 금지), 개인정보 최소 저장

---

## 0) 결론(바로 적용할 방향)
- **Hero 섹션은 유지**하되 “광고형”이 아니라 **체험형**으로 설계한다.
- 랜딩 Hero에는 **샘플 얼굴**을 사용해 “탭/호버 전환”을 즉시 경험시킨다.
- **내 사진 업로드**는 반드시 **로그인 + 동의(ConsentGate)** 이후에만 제공한다.
- Hero 아래에는 “설명”보다 **3단 카드(사용 흐름)** + **피부과 찾기 섹션**을 배치한다.

---

## 1) 전체 IA / 페이지 구성

### 1.1 페이지/라우트
- `/` 또는 `/derma` (랜딩)
  - 체험형 Hero(샘플 전환)
  - 3단 사용 흐름 카드
  - 운영 중 피부과 찾기(현 UI 유지)
- `/healthcare/face-style` (로그인 필요)
  - ConsentGate
  - 업로드 → 변환 생성 → 탭 전환 뷰어
  - 결과 하단: 피부과 찾기/상담 연결 CTA

### 1.2 컴포넌트(권장)
- `HeroExperience.tsx` (샘플 전환 포함)
- `HowItWorksCards.tsx` (3단 카드)
- `ClinicFinderSection.tsx` (기존 “지금 운영 중인 피부과 찾기”)
- `ConsentGate.tsx`
- `PhotoUploader.tsx`
- `VariantTabs.tsx` + `FaceSwapViewer.tsx`
- `ProgressPanel.tsx`
- `DeleteMyPhotosButton.tsx`

---

## 2) 랜딩 UI 스펙 (체험형 Hero)

### 2.1 Hero 레이아웃(현재 UI 기반)
- 좌측: 카피 + CTA 2개 + 고지
- 우측: **샘플 전환 뷰어(탭/호버)**
- 하단: 히어로 도트/슬라이드(선택) 또는 2~3개 히어로 변형

### 2.2 Hero 카피(의료법 안전 톤)
- 헤더 태그(작게): `ROUTINE · BASE · GLOW · RESET`
- 타이틀 예시:
  - `베이스가 달라지는 루틴 정리`
  - `나의 루틴 포인트를 빠르게 정리`
- 서브카피 예시:
  - `지금 상태를 간단히 체크하고, 오늘부터 적용할 루틴 포인트를 정리해보세요.`
- 고지(상시 노출):
  - `참고용 안내이며 진단·처방이 아닙니다.`

### 2.3 Hero CTA(2단 CTA 필수)
- Primary CTA(비로그인 가능):
  - 버튼 텍스트: `30초 체크 시작`
  - 동작: `/healthcare/check` (또는 모달/스텝폼)
- Secondary CTA(로그인 유도):
  - 버튼 텍스트: `사진으로 스타일 보기`
  - 동작: 로그인 페이지 → 완료 후 `/healthcare/face-style`로 리다이렉트

> 랜딩에서 “사진 업로드”를 직접 받지 않는다. 랜딩은 샘플 체험만 제공한다.

### 2.4 샘플 전환 뷰어(랜딩)
- 탭 3개:
  - `내추럴` / `메이크업` / `밝은 톤`
- PC: hover 시 “선택 탭 이미지”가 강조(미세 효과)
- 모바일: 탭 클릭으로 이미지 전환
- 전환 방식: 크로스페이드 200~350ms
- 샘플 이미지는 내부 에셋 사용(개인사진/유저사진 사용 금지)

---

## 3) Hero 아래 섹션(설명보다 흐름)

### 3.1 3단 카드(How it works)
1) `30초 체크`
   - `현재 루틴/고민을 빠르게 정리`
2) `사진으로 스타일 보기`
   - `로그인/동의 후 내 사진으로 예시 확인`
3) `가까운 피부과 찾기`
   - `지역·시간 기준으로 바로 탐색`

> 카드 하단 링크는 각각 해당 섹션/페이지로 이동.

### 3.2 운영 중 피부과 찾기 섹션(현 UI 유지)
- 제목: `지금 운영 중인 피부과 찾기`
- 설명: `지역과 운영 시간을 선택해 가까운 피부과를 검색하세요.`
- 필터: 지역/시간(필요 시 진료 항목)
- 결과: 카드 리스트 + “상담/예약” 버튼

---

## 4) 로그인 후 기능 UI (ConsentGate + 업로드 + 변환 + 탭 전환)

### 4.1 ConsentGate(필수)
- 필수 체크 3개:
  - `[필수] 가상 스타일 변환 예시를 위해 사진 처리에 동의합니다.`
  - `[필수] 본 기능은 참고용이며 진단·처방이 아닙니다.`
  - `[필수] 보관/삭제 정책을 확인했습니다.`
- 동의 완료 후에만 업로드 UI 노출

### 4.2 업로드 UX
- 지원: jpg/png, 용량 제한(예: 8MB)
- 권장 안내(짧게):
  - `정면에 가깝고, 얼굴이 잘 보이는 사진이 결과가 안정적입니다.`
- 업로드 완료 후:
  - 자동으로 `generate` 실행(옵션: “변환 시작” 버튼)

### 4.3 결과 뷰어(탭 전환)
- 탭:
  - `내추럴` / `메이크업` / `밝은 톤`
- UI:
  - 좌측: 이미지 뷰어
  - 우측: 선택 탭 설명 + 고지 + “내 사진 삭제” 버튼
- 하단 CTA:
  - `가까운 피부과 찾기` (ClinicFinder로 스크롤 또는 링크)
  - `상담 연결` (서비스 정책에 맞는 상담 폼으로)

---

## 5) 데이터/스토리지/보안 (Supabase)

### 5.1 테이블
#### `user_consents`
- `id` uuid pk
- `user_id` uuid unique
- `consent_face_style` bool
- `consent_version` text
- `consented_at` timestamptz
- `created_at`, `updated_at`

#### `face_style_sessions`
- `id` uuid pk
- `user_id` uuid index
- `status` text (`uploaded` | `generating` | `ready` | `failed`)
- `original_image_path` text
- `original_uploaded_at` timestamptz
- `error_message` text nullable
- `created_at`, `updated_at`

#### `face_style_variants`
- `id` uuid pk
- `session_id` uuid fk
- `variant_key` text (`natural` | `makeup` | `bright`)
- `status` text (`queued` | `done` | `failed`)
- `image_path` text
- `created_at`, `updated_at`

### 5.2 Storage
- bucket: `face-style` (private)
- paths:
  - original: `face-style/{user_id}/{session_id}/original.jpg`
  - variants: `face-style/{user_id}/{session_id}/{variant_key}.jpg`
- 접근: Signed URL 발급 방식(권장)

### 5.3 RLS 요약
- 모든 테이블: `user_id = auth.uid()` 기준
- variants는 session 조인으로 본인 검증
- storage는 서버에서만 signed 발급(클라이언트는 URL만 사용)

---

## 6) API 설계(Next.js Route Handlers)

### 6.1 `POST /api/face-style/session/create`
- 세션 생성 + original 업로드용 Signed Upload URL 발급
- output: `sessionId`, `signedUploadUrl`, `objectPath`

### 6.2 `POST /api/face-style/session/mark-uploaded`
- 업로드 완료 기록 + variants 3개 queued 생성
- input: `{ sessionId }`

### 6.3 `POST /api/face-style/session/generate`
- 동의 확인 → 원본 다운로드 → 변환 3종 생성 → storage 업로드 → ready
- input: `{ sessionId }`

### 6.4 `GET /api/face-style/session/get?sessionId=...`
- 상태 + signed get urls 반환

---

## 7) 이미지 변환 가이드(운영 안전 중심)

### 7.1 변환 원칙
- 정체성 유지 최우선
- 형태 변화(성형/윤곽 변경) 금지
- 과한 “동안화” 금지(“다른 사람” 리스크)
- fallback: 변환 실패 시 `내추럴`만 제공

### 7.2 변환 옵션 정의
- natural: 피부결/톤 정리(과하지 않게)
- makeup: 데일리 메이크업(립/아이/톤 정도)
- bright: 자연광/밝은 톤(색감 개선)

---

## 8) 보관/삭제 정책(필수)

### 8.1 기본 정책(MVP 권장)
- 원본: 24시간 후 자동 삭제
- 변형본: 30일 보관(또는 사용자 즉시 삭제 가능)

### 8.2 구현
- 스케줄 잡(Cron):
  - 원본 만료 시 storage 삭제 + DB 상태 업데이트
- 사용자 버튼:
  - “내 사진 삭제” 즉시 수행(원본+변형 모두 삭제)

---

## 9) 상태 메시지(UX 문구)
- 업로드: `사진 업로드가 완료되었습니다.`
- 생성중: `스타일 변환을 준비 중입니다. 잠시만 기다려주세요.`
- 완료: `변환이 완료되었습니다. 탭으로 확인해보세요.`
- 일부 실패: `일부 변환에 실패했습니다. 기본 보정 버전으로 확인해 주세요.`

---

## 10) 완료 기준(Done Definition)
- 랜딩 Hero에서 **샘플 전환**이 PC/모바일 모두 즉시 동작
- 내 사진 업로드는 **로그인+동의 후에만** 가능
- 업로드 후 3종 변형 중 최소 2종 이상 제공(실패 시 fallback)
- Signed URL 기반으로만 이미지 접근
- 원본 자동 삭제 정책 동작 + 사용자 즉시 삭제 가능
- 모든 화면에 “참고용/진단 아님” 고지 상시 노출

---

## 11) 파일 트리(권장)
- `app/(marketing)/page.tsx` (랜딩)
- `components/landing/HeroExperience.tsx`
- `components/landing/HowItWorksCards.tsx`
- `components/landing/ClinicFinderSection.tsx`

- `app/healthcare/face-style/page.tsx`
- `components/face-style/ConsentGate.tsx`
- `components/face-style/PhotoUploader.tsx`
- `components/face-style/ProgressPanel.tsx`
- `components/face-style/FaceSwapViewer.tsx`
- `components/face-style/DeleteMyPhotosButton.tsx`

- `app/api/face-style/session/create/route.ts`
- `app/api/face-style/session/mark-uploaded/route.ts`
- `app/api/face-style/session/generate/route.ts`
- `app/api/face-style/session/get/route.ts`

---

## 12) 다음 액션(개발 순서)
1) 랜딩 HeroExperience(샘플 전환)부터 구현
2) ConsentGate + 업로드 + Viewer UI 구현
3) Supabase 테이블/RLS/Storage 세팅
4) API 4종 구현 후 연결
5) 자동 삭제(Cron) + 즉시 삭제 버튼
6) QA: 모바일 탭 UX, signed url 만료, 실패 fallback
